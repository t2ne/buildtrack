@model BuildTrackMVC.Models.Cliente

@{
    ViewData["Title"] = "Novo Cliente";
}

<h2>Novo Cliente</h2>

<form asp-action="Create" method="post" novalidate>
    <div class="mb-3">
        <label asp-for="Nome" class="form-label"></label>
        <input asp-for="Nome" class="form-control" required />
        <span asp-validation-for="Nome" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="NIF" class="form-label"></label>
        <input asp-for="NIF" class="form-control" required pattern="\d{9}" />
        <span asp-validation-for="NIF" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Morada" class="form-label"></label>
        <input asp-for="Morada" class="form-control" required />
        <span asp-validation-for="Morada" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Email" class="form-label"></label>
        <input asp-for="Email" class="form-control" required type="email" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Telefone" class="form-label"></label>
        <input asp-for="Telefone" class="form-control" required pattern="\d{9}" />
        <span asp-validation-for="Telefone" class="text-danger"></span>
    </div>

    <button type="submit" class="btn btn-success">Guardar</button>
    <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(function () {
            $("form").submit(function (e) {
                if (!$(this).valid()) {
                    e.preventDefault();
                    e.stopPropagation();

                    // Colecta todos os erros visíveis
                    let messages = [];
                    $(this).find(".input-validation-error").each(function () {
                        const label = $("label[for='" + $(this).attr("id") + "']").text();
                        messages.push(`${label} está incorreto ou obrigatório.`);
                    });

                    if (messages.length) {
                        showToast(messages.join("<br>"), 'warning');
                    }

                    return false;
                }
            });
        });
    </script>
}
